## Filter Pattern

- [Filter Pattern](#filter-pattern)
  - [过滤器模式 (Filter)](#过滤器模式-filter)
  - [模式设计](#模式设计)
    - [过滤器优缺点](#过滤器优缺点)
    - [应用场景](#应用场景)
    - [注意事项](#注意事项)
  - [案例实现](#案例实现)
  - [过滤器一般组成角色](#过滤器一般组成角色)


---
### 过滤器模式 (Filter)

过滤器模式 (Filter Pattern) 或标准模式 (Criteria Pattern) 是一种设计模式，这种模式允许开发人员使用不同的标准来过滤一组对象，通过逻辑运算以解耦的方式把它们连接起来。这种类型的设计模式属于结构型模式，它结合多个标准来获得单一标准。
  
> **意图**  

- 意图: 对一组对象采用不同的标准分类或过滤。
- 主要解决: 
  - 主要用于统一接收并过滤客户端的请求，根据过滤器的选择，将请求传送给对应的目标处理程序；
  - 复杂内部对象之间的高耦合进行解耦，通过逻辑算法将它们串联起来。

- 何时使用: 软件由多个复杂的处理流程组成，每个处理有自己独特的处理逻辑，流程不容易控制，每个流程的输出不容易得到及时的反馈，编写代码较为复杂，处理流程混乱，不容易形成体系结构，不容易进行任务的分解与分工，而且代码不容易测试及维护。明确进行流程化管理时, 筛选出必要与非必要对象。

- 如何解决: 
  1. 采用管道-过滤器模式进行软件体系结构的设计。软件由多个独立的处理流才能组成，则将每个处理流程当做一个过滤器，过滤器是由一个输入接口、一个处理模块和一个输出接口组成，而且是一个独立的实体。
  2. 满足处理过程的独立处理，接受输入和输出的要求。而且过滤器有自己的处理机制，可以对所有的输入都进行处理，还可以对一部分数据进行处理，还可以进行数据的检测，当数据不满足要求时，可以及时地做出回应，进行错误处理。而且管道作为数据的传输介质在过滤器之间进行数据的传输，很好地满足了流程的处理。

- 关键代码: 
  1. 创建多个过滤器标准，在管道层用于过滤数据对象，日志或者用户输入。
  2. 管道作为过滤器之间数据流动的通道的软件部件,它的主要功能是连接各个过滤器,充当过滤器之间数据流的通道。管道具有数据缓冲以及提高过滤器之间的并行性操作的作用。管道由数据缓冲区,向数据缓冲区读和写数据,判断管道为空或已满等操作定义组成。

> 动机

流程化处理数据或者处理用户请求时, 根据请求的等级不同, 通过过滤器对所有的输入进行分类, 通过管道将多个过滤器按一定的优先级顺序串联, 对用户请求分级处理(也可以用来数据处理)

>---
### 模式设计

> **过滤器模式**

   ![结构](img/过滤器模式设计.png)

#### 过滤器优缺点

> 优点: 
  1. 设计人员将整个系统的输入输出行为理解为单个过滤器行为的叠加与组合。这样可以将问题分解,化繁为简。
  2. 任何两个过滤器,只要它们之间传送的数据遵守共同的规约就可以相连接。每个过滤器都有自己独立的输入输出接口,如果过滤器间传输的数据遵守其规约,只要用管道将它们连接就可以正常工作。
  3. 整个系统易于维护和升级:旧的过滤器可以被替代,新的过滤器可以添加到已有的系统上。

> 缺点:
  1. 不适合处理交互的应用。
  2. 传输的数据没有标准化，所以读入数据和输出数据存在着格式转换等问题，会导致性能的降低。

#### 应用场景

1. 垃圾分类系统，垃圾过滤分类的思想本身就是一种过滤模式。 
2. 消息过滤系统，对日志信息的过滤，图书馆图书分类系统等。
3. AI 逻辑处理单元  
4. 一个应用程序可能需要执行各种关于它处理的信息不同复杂的任务。一个简单，但不灵活的方式来实施这个应用程序可以执行此处理为单一模块。然而，这种方法有可能减少用于重构代码，对其进行优化，或者重新使用它，如果是在应用程序中其他地方所需要的相同的处理的部件的机会。

#### 注意事项

- 可插拔：过滤器的设计概念要求其是支持可插拔设计的；
- 有序性：过滤器是被设计为一组组的过滤装置，要实现数据过滤，就必须有顺序性要求，比如我们要设计编解码过滤器，用户请求过来的 xml 数据会优先通过 xml2json 过滤器进行数据处理，完了再在响应发出前进行相应的 json2xml 过滤处理，以保证客户端交互以 xml 数据格式为准的同时系统内部数据交互还是维持 json 格式不变；
- 过滤器的独立性：每种过滤器必须是独立的实体，其状态不受其它过滤器的影响，每个过滤器都有自己独立的数据输入输出接口，只要各个过滤器之间传送的数据遵守共同的规约就可以相连接。

>---
### 案例实现

- 我们将创建一个 Person 对象、Criteria 接口和实现了该接口的实体类，来过滤 Person 对象的列表。CriteriaPatternDemo，我们的演示类使用 Criteria 对象，基于各种标准和它们的结合来过滤 Person 对象的列表。

    ![案例](img/过滤器模式案例.png)

>---
### 过滤器一般组成角色

1. AbstractFilter (抽象过滤器角色) ：负责定义过滤器的实现接口，具体的实现还要具体过滤器角色去参与，客户端可以调用抽象过滤器角色中定义好的方法，将客户端的所有请求委派到具体的实现类去，从而让实现类去处理；
2. ConcreteFilter (具体过滤器角色) ：该角色负责具体筛选规则的逻辑实现，最后再返回一个过滤后的数据集合，标准的过滤器只对数据做过滤，当然也可以对集合中的数据做某项处理，再将处理后的集合返回；
3. Target (被过滤的主体角色) ：一个软件系统中可以有一个或多个目标角色，在具体过滤器角色中会对指定感兴趣的目标进行处理，以确保后面的数据确实是我想要的。
4. Filter Chain (过滤器链) ：过滤器链带有多个过滤器，并在 Target 之前按照定义的顺序执行这些过滤器。
5. Filter Manager (过滤管理器) ：过滤管理器管理过滤器和过滤器链。

---